"use strict";var YoastShortcodePlugin=function(){this.registerTime=0,this.register(this.bindElementEvents),this.unparsedShortcodes=[],this.parsedShortcodes=[],this.keywordRegex="("+wpseoShortcodePluginL10n.wpseo_shortcode_tags.join("|")+")",this.loadShortcodes()};YoastShortcodePlugin.prototype.register=function(a){"undefined"!=typeof YoastSEO&&"undefined"!=typeof YoastSEO.app&&"undefined"!=typeof YoastSEO.app.plugins?(YoastSEO.app.plugins.register("YoastShortcodePlugin",{status:"loading"}),"function"==typeof a&&a()):this.registerTime<1001?(this.registerTime+=100,setTimeout(function(){yoastShortcodePlugin.register(a)},100)):console.error("Failed to register shortcode plugin with YoastSEO. YoastSEO is not available.")},YoastShortcodePlugin.prototype.declareReady=function(){YoastSEO.app.plugins.ready("YoastShortcodePlugin"),yoastShortcodePlugin.registerModifications()},YoastShortcodePlugin.prototype.declareReloaded=function(){YoastSEO.app.plugins.reloaded("YoastShortcodePlugin")},YoastShortcodePlugin.prototype.registerModifications=function(){YoastSEO.app.plugins.registerModification("title",this.replaceShortcodes,"YoastShortcodePlugin"),YoastSEO.app.plugins.registerModification("content",this.replaceShortcodes,"YoastShortcodePlugin")},YoastShortcodePlugin.prototype.replaceShortcodes=function(a){var b=yoastShortcodePlugin.parsedShortcodes;if("string"==typeof a&&b.length>0)for(var c in b)a=a.replace(b[c].shortcode,b[c].output);return a},YoastShortcodePlugin.prototype.loadShortcodes=function(){var a=document.getElementById("title").value,b=document.getElementById("yoast_wpseo_title").value,c=this.getContentTinyMCE(),d=document.getElementById("yoast_wpseo_metadesc").value;this.checkShortcodes(a),this.checkShortcodes(b),this.checkShortcodes(c),this.checkShortcodes(d),this.parseShortcodes(this.declareReady)},YoastShortcodePlugin.prototype.bindElementEvents=function(){for(var a=["title","snippet_title","snippet_meta","content"],b=0;b<a.length;b++)document.getElementById(a[b]).addEventListener("keydown",yoastShortcodePlugin.inputEventCallback),document.getElementById(a[b]).addEventListener("input",yoastShortcodePlugin.inputEventCallback)},YoastShortcodePlugin.prototype.inputEventCallback=function(a){var b;b="content"===a.currentTarget.id?yoastShortcodePlugin.getContentTinyMCE():"SPAN"===a.currentTarget.tagName?a.currentTarget.textContent:a.currentTarget.value,yoastShortcodePlugin.checkShortcodes(b),yoastShortcodePlugin.parseShortcodes(yoastShortcodePlugin.declareReloaded)},YoastShortcodePlugin.prototype.getContentTinyMCE=function(){var a=document.getElementById("content").value;return 0!==tinyMCE.editors.length&&(a=tinyMCE.get("content").getContent()),a},YoastShortcodePlugin.prototype.checkShortcode=function(a){var b=!1;for(var c in this.parsedShortcodes)this.parsedShortcodes[c].shortcode===a&&(b=!0);b===!1&&this.unparsedShortcodes.push(a)},YoastShortcodePlugin.prototype.checkShortcodes=function(a){if("string"!=typeof a)return console.error("Failed to get unparsed shortcodes. Expected parameter to be a string, instead received"+typeof a),!1;var b=this.matchShortcodes(a);for(var c in b){var d=b[c];-1===this.unparsedShortcodes.indexOf(d)&&this.checkShortcode(d)}return!0},YoastShortcodePlugin.prototype.matchShortcodes=function(a){var b=this.getCapturesFromText(a);for(var c in b)a=a.replace(b[c],"");var d="\\["+this.keywordRegex+"[^\\]]*?\\]",e=a.match(new RegExp(d,"g"))||[];return b.concat(e)},YoastShortcodePlugin.prototype.getCapturesFromText=function(a){var b=[],c="\\[\\/"+this.keywordRegex+"\\]",d=(a.match(new RegExp(c,"g"))||[]).join(" ").match(new RegExp(this.keywordRegex,"g"));for(var e in d){var f=d[e],g="\\["+f+"[^\\]]*?\\].*?\\[\\/"+f+"\\]",h=a.match(new RegExp(g,"g"))||[];b=b.concat(h)}return b},YoastShortcodePlugin.prototype.parseShortcodes=function(a){if("function"!=typeof a)return console.error("Failed to parse shortcodes. Expected parameter to be a function, instead received "+typeof a),!1;if("object"==typeof this.unparsedShortcodes&&this.unparsedShortcodes.length>0){var b=this.unparsedShortcodes;this.unparsedShortcodes=[];var c=this;jQuery.get(ajaxurl,{action:"wpseo_filter_shortcodes",_wpnonce:wpseoShortcodePluginL10n.wpseo_filter_shortcodes_nonce,data:b},function(b){b=JSON.parse(b);for(var d in b)c.parsedShortcodes.push(b[d]);a()})}else a()};